<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="main.css?before1" rel="stylesheet">
</head>
<body>
  <img id="layer_fixed" onclick="javascript:location.href='/upload.html';" style="right:20px;bottom:70px" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/%EA%B7%B8%EB%A6%BC1.png?alt=media&token=1c03a490-2027-4ddf-aa4c-8bc7cba04296" alt="My Image" width="100">

    <div class="frame1">
      <div class="top-box1"style="width:70%;height:100%;line-height:40px;display:inline-block;">
      <span style=" font-size:20px; font-weight:1000;vertical-align:middle; ">&nbsp거주지 설정∨</span>
      </div
      ><div class="top-box2"style="width:15%;height:100%;line-height:40px;display:inline-block;">
      <img id="reload" onclick="window.location.reload()"  alt="My Image" width="30" style="width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/restart-line.png?alt=media&token=b7bcee4d-f99e-4020-8d69-dcf4264a7d52">
      </div
      ><div class="top-box3"style="width:15%;height:100%;line-height:40px;display:inline-block;">
      <img id="search" onclick="javascript:location.href='/upload.html';"  alt="My Image" width="30" style="width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/search-line.png?alt=media&token=1bcb436b-715e-4942-9a57-eb7653834405">
      </div>
    </div>
    <div class="frame2">
      <div class="box1" style="width:20%;height:100%;line-height:40px;text-align:center;display:inline-block;"onclick="javascript:location.href='/upload.html';">
      <img id="home"  alt="My Image" style="width:30px;height:30px;vertical-align:middle;"  src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/home-4-line%20(1).png?alt=media&token=4ba414b7-9e4f-4a52-95ea-48916088ba82">
      <img id="home-off" alt="My Image" width="30" style="display:none;position:fixed;right:15px;bottom:9px" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/home-4-fill%20(1).png?alt=media&token=dddbb666-3b7b-443a-b7c2-f0361c4078c6">
      </div
      ><div class="box2" style="width:20%;height:100%;line-height:40px;text-align:center;display:inline-block;"onclick="javascript:location.href='/upload.html';">
      <img id="neighbor"  alt="My Image" width="30" style="width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/group-line.png?alt=media&token=25956aa5-8aaa-459c-b001-5da37414b500">
      <img id="neighbor-off"  alt="My Image" width="30" style="display:none;width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/group-fill.png?alt=media&token=b0bc3f94-7422-4e5a-bc20-8474518668e2">
      </div
      ><div class="box3" style="width:20%;height:100%;line-height:40px;text-align:center;display:inline-block;"onclick="javascript:location.href='/upload.html';">
      <img id="chat"  alt="My Image" width="30" style="width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/chat-smile-2-line.png?alt=media&token=78c0cc07-4143-45ae-b2fc-57fbe38367c6">
      <img id="chat-off"  alt="My Image" width="30" style="display:none;width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/chat-smile-2-fill.png?alt=media&token=1f9f0d07-7f9a-40b6-907f-a7b6b68d6ce4">
      </div
      ><div class="box4" style="width:20%;height:100%;line-height:40px;text-align:center;display:inline-block;"onclick="javascript:location.href='/upload.html';">
      <img id="scrap"  alt="My Image" width="30" style="width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/star-smile-line.png?alt=media&token=f27bd6b8-26aa-42a4-a44b-6f88d8422bf9">
      <img id="scrap-off"  alt="My Image" width="30" style="display:none;width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/star-smile-fill.png?alt=media&token=dd85070e-c00d-41c1-a439-2daf4de62051">
      </div
      ><div class="box5" style="width:20%;height:100%;line-height:40px;text-align:center;display:inline-block;"onclick="javascript:location.href='/upload.html';">
      <img id="user" alt="My Image" width="30" style="width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/user-5-line.png?alt=media&token=d8e556bc-d722-47ce-be76-53217c7856da">
      <img id="user-off"  alt="My Image" width="30" style="display:none;width:30px;height:30px;vertical-align:middle;" src="https://firebasestorage.googleapis.com/v0/b/delivery-16353.appspot.com/o/user-5-fill.png?alt=media&token=f9032a69-8c73-43f0-8b88-67ccd28e8cca">
    </div>
    </div>

    
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
  <script>
   const firebaseConfig = {
  apiKey: "AIzaSyCvbCUJDTfWjTOswm4F3oMHA2hc4Wirj4I",
  authDomain: "delivery-16353.firebaseapp.com",
  projectId: "delivery-16353",
  storageBucket: "delivery-16353.appspot.com",
  messagingSenderId: "727523902461",
  appId: "1:727523902461:web:144febdfc79a0e0e9d0f94",
  measurementId: "G-2K1K6GZT7V"
};
firebase.initializeApp(firebaseConfig);
    </script>
    <!-- <button type="submit" class="btn btn-primary" id="logout">로그아웃</button> -->
    <div class="container">
    </div>
        <script>
            var lastvis=-1;
            const db = firebase.firestore();
            var lastVisible;
            var check=0;
            //무한스크롤기능---------------------------------------------------------------------------------
            function debounce(callback, limit = 100) {
    let timeout
    return function(...args) {
        clearTimeout(timeout)
        timeout = setTimeout(() => {
            callback.apply(this, args)
        }, limit)
    }
}

// ===== 무한 스크롤 (스크롤 이벤트) =====
document.addEventListener("scroll", debounce(e => {
    // clientHeight : 웹 브라우저 창의 높이
    // scrollTop : 현재 스크롤된 부분의 맨 위의 높이
    // scrollHeight : 문서의 총 높이 (= 스크롤의 총 높이)
    // 스크롤의 마지막에 도달 : clientHeight + scrollTop >= scrollHeight
    
    const { clientHeight, scrollTop, scrollHeight } = e.target.scrollingElement
    if(clientHeight + scrollTop >= scrollHeight-1000&&check==0) {
      console.log(scrollHeight)
        fetchLorem()
    }
    else {
      return
      }
}, 200))
//무한스크롤기능------------------------------------------------------------------------------------------
              db.collection('product').orderBy('when','desc').limit(15).get().then((결과)=>{
                lastVisible = 결과.docs[결과.docs.length - 1]
                결과.forEach((doc)=>{
                    var 템플릿=`<a href="/detail.html?id=${doc.id}"><div class="product">  
                      <div class="thumbnail" style="background-image:url(${doc.data().picture})"></div>
                      <div class="title" >${doc.data().space}${"&nbsp"}</div>
                      <div class="content">${doc.data().content}${"&nbsp"}</div>
                      <div class="price">${doc.data().ptime}${"&nbsp"}</div>
                      <span class="date">${doc.data().when.toDate().toDateString()}</span>
                      <div class="float-end">♡0</div>
            </div>
          </div></a>`;
                    $('.container').append(템플릿)
                    console.log(lastVisible)
                    })})
            
                    function fetchLorem(){
        
            db.collection('product').orderBy('when','desc').startAfter(lastVisible).limit(10).get().then((결과)=>{
              if(결과.docs.length<10){
                check=1;
              }
              lastVisible = 결과.docs[결과.docs.length - 1]
                결과.forEach((doc)=>{
                  var 템플릿=`<a href="/detail.html?id=${doc.id}"><div class="product">
                      <div class="thumbnail" style="background-image:url(${doc.data().picture})"></div>
                      <div class="title" >${doc.data().space}${"&nbsp"}</div>
                      <div class="content">${doc.data().content}${"&nbsp"}</div>
                      <div class="price"> ${doc.data().ptime}${"&nbsp"}</div>
                      <span class="date">${doc.data().when.toDate().toDateString()}</span>
                      <div class="float-end" >♡0</div>
            </div>
          </div></a>`;
                    $('.container').append(템플릿)   })})
            }
        //     $('#logout').click(function(){
        //    localStorage.removeItem('user')
        //    firebase.auth().signOut()
        //  })
         firebase.auth().onAuthStateChanged((user)=>{
           if (user){
             console.log(user.displayName)
             localStorage.setItem('user',JSON.stringify(user))
           }
           else{
             window.location.href='/login.html'
           }
         })
             
        </script>
        
</body>
</html>